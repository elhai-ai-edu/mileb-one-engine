<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>MilEd.One Cockpit v2 – System Manager</title>

<style>

body{
font-family:'Segoe UI',sans-serif;
background:#1a2a3a;
padding:20px;
color:#333;
}

.cockpit{
max-width:1300px;
margin:auto;
background:#ecf0f1;
padding:30px;
border-radius:12px;
}

.section{
background:white;
padding:20px;
margin-bottom:20px;
border-radius:8px;
}

.tool{
background:#f8f9fa;
padding:15px;
margin-top:10px;
border-radius:6px;
border:1px solid #ddd;
}

input, textarea, select{

width:100%;
padding:8px;
margin-bottom:8px;
border-radius:5px;
border:1px solid #ccc;

}

textarea{
height:100px;
}

button{

border:none;
padding:8px 12px;
border-radius:6px;
cursor:pointer;

}

.add{
background:#27ae60;
color:white;
}

.delete{
background:#c0392b;
color:white;
}

.save{
background:#e67e22;
color:white;
width:100%;
padding:15px;
font-size:18px;
margin-top:20px;
}

.userbar{
background:#34495e;
color:white;
padding:10px;
margin-bottom:15px;
border-radius:6px;
}

</style>

</head>

<body>

<div class="cockpit">

<div class="userbar">

משתמש נוכחי:
<span id="currentUser"></span>

</div>

<h1>MilEd Cockpit v2</h1>

<div id="editor"></div>

<button class="save" onclick="saveConfig()">
שמור config לשרת
</button>

</div>

<script>

let config={}

let currentUser=null

const branchKeys=["courses","faculty","skills","admin"]

init()

async function init(){

currentUser=await getCurrentUser()

document.getElementById("currentUser").innerText=
currentUser.id+" ("+currentUser.role+")"

const res=await fetch("/config.json")

config=await res.json()

render()

}

async function getCurrentUser(){

/*
בעתיד יגיע מהשרת
כרגע mock
*/

return{

id:"faculty_123",

role:"faculty"

}

}

function render(){

const root=document.getElementById("editor")

root.innerHTML=""

branchKeys.forEach(branchKey=>{

const branch=config.branches[branchKey]

let html=`

<div class="section">

<h2>${branch.title}</h2>

<button class="add"
onclick="addTool('${branchKey}')">

+ הוסף כלי חדש

</button>

`

for(let id in branch.items){

html+=renderTool(branchKey,id,branch.items[id])

}

html+="</div>"

root.innerHTML+=html

})

}

function renderTool(branch,id,tool){

return`

<div class="tool">

<label>name</label>

<input
value="${tool.name||''}"
onchange="update('${branch}','${id}','name',this.value)">

<label>botType</label>

<input
value="${tool.botType||''}"
onchange="update('${branch}','${id}','botType',this.value)">

<label>systemPrompt</label>

<textarea
onchange="update('${branch}','${id}','systemPrompt',this.value)">

${tool.systemPrompt||''}

</textarea>

<label>thinkingBudget</label>

<input type="number"

value="${tool.thinkingBudget||512}"

onchange="update('${branch}','${id}','thinkingBudget',parseInt(this.value))">

<label>scope (תחום הרשאה)</label>

<select
onchange="update('${branch}','${id}','scope',this.value)">

<option ${tool.scope==="global"?"selected":""}>global</option>

<option ${tool.scope==="faculty_private"?"selected":""}>faculty_private</option>

<option ${tool.scope==="institution"?"selected":""}>institution</option>

<option ${tool.scope==="course_specific"?"selected":""}>course_specific</option>

</select>

<label>visibility (רמת חשיפה)</label>

<select
onchange="update('${branch}','${id}','visibility',this.value)">

<option ${tool.visibility==="system"?"selected":""}>system</option>

<option ${tool.visibility==="faculty"?"selected":""}>faculty</option>

<option ${tool.visibility==="institution"?"selected":""}>institution</option>

</select>

<label>owner (בעלים)</label>

<input
value="${tool.owner||''}"
onchange="update('${branch}','${id}','owner',this.value)">

<label>createdBy</label>

<input
value="${tool.createdBy||''}"
onchange="update('${branch}','${id}','createdBy',this.value)">

<label>version</label>

<input
value="${tool.version||'1.0'}"
onchange="update('${branch}','${id}','version',this.value)">

<button class="delete"
onclick="deleteTool('${branch}','${id}')">

מחק

</button>

</div>

`

}

function update(branch,id,key,value){

config.branches[branch].items[id][key]=value

}

function addTool(branch){

const id="tool_"+Date.now()

config.branches[branch].items[id]={

id:id,

name:"כלי חדש",

botType:"",

systemPrompt:"",

thinkingBudget:512,

scope:"faculty_private",

visibility:"faculty",

owner:currentUser.id,

createdBy:currentUser.id,

createdAt:new Date().toISOString(),

version:"1.0"

}

render()

}

function deleteTool(branch,id){

delete config.branches[branch].items[id]

render()

}

async function saveConfig(){

await fetch("/api/saveConfig",{

method:"POST",

headers:{
"Content-Type":"application/json"
},

body:JSON.stringify(config)

})

alert("config נשמר בהצלחה")

}

</script>

</body>
</html>

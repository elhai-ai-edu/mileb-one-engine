<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>MilEd.One Cockpit – System Configuration</title>

<style>

body{
font-family:'Segoe UI',sans-serif;
background:#1a2a3a;
color:#333;
padding:20px;
}

.cockpit-card{
max-width:1200px;
margin:auto;
background:#ecf0f1;
padding:30px;
border-radius:15px;
box-shadow:0 10px 30px rgba(0,0,0,0.5);
}

.section{
background:white;
padding:20px;
border-radius:10px;
margin-bottom:25px;
border-right:8px solid #3498db;
}

.item-box{
background:#f8f9fa;
padding:15px;
border-radius:8px;
margin-top:15px;
}

input, textarea, select{
width:100%;
padding:8px;
margin-top:5px;
margin-bottom:10px;
border-radius:5px;
border:1px solid #ccc;
font-family:inherit;
}

textarea{
height:120px;
}

button{
cursor:pointer;
border:none;
padding:10px;
border-radius:6px;
}

.btn-add{
background:#27ae60;
color:white;
}

.btn-delete{
background:#c0392b;
color:white;
}

.btn-save{
background:#e67e22;
color:white;
width:100%;
padding:18px;
font-size:1.2rem;
margin-top:20px;
}

</style>
</head>

<body>

<div class="cockpit-card">

<h1>MilEd.One Cockpit – System Configuration</h1>

<div id="editor"></div>

<button class="btn-save" onclick="generateConfig()">
שמור והפק config.json
</button>

<textarea id="output" style="display:none;"></textarea>

</div>

<script>

let config={}

const branchKeys=[
"courses",
"faculty",
"skills",
"admin"
]

fetch("/config.json")
.then(r=>r.json())
.then(data=>{
config=data
render()
})

function render(){

const root=document.getElementById("editor")
root.innerHTML=""

branchKeys.forEach(branchKey=>{

const branch=config.branches[branchKey]

let html=`
<div class="section">

<h2>${branch.title}</h2>

<button class="btn-add"
onclick="addTool('${branchKey}')">
+ הוסף כלי
</button>
`

for(let id in branch.items){

const tool=branch.items[id]

html+=createToolEditor(branchKey,id,tool)

}

html+="</div>"

root.innerHTML+=html

})

}

function createToolEditor(branch,id,tool){

return`

<div class="item-box">

<label>שם הכלי</label>
<input
value="${tool.name||''}"
onchange="update('${branch}','${id}','name',this.value)">

<label>botType</label>
<input
value="${tool.botType||''}"
onchange="update('${branch}','${id}','botType',this.value)">

<label>System Prompt</label>
<textarea
onchange="update('${branch}','${id}','systemPrompt',this.value)"
>${tool.systemPrompt||''}</textarea>

<label>thinkingBudget</label>
<input
type="number"
value="${tool.thinkingBudget||512}"
onchange="update('${branch}','${id}','thinkingBudget',parseInt(this.value))">

<label>layer</label>
<select
onchange="update('${branch}','${id}','_layer',this.value)">

<option value="course_general">course_general</option>
<option value="course_task">course_task</option>
<option value="skills_process">skills_process</option>
<option value="faculty_tool">faculty_tool</option>
<option value="faculty_monitoring_tool">faculty_monitoring_tool</option>
<option value="admin_tool">admin_tool</option>

</select>

<label>scope</label>
<select
onchange="update('${branch}','${id}','scope',this.value)">

<option value="global">global</option>
<option value="faculty_private">faculty_private</option>
<option value="institution">institution</option>
<option value="course_specific">course_specific</option>

</select>

<label>owner</label>
<input
value="${tool.owner||'system'}"
onchange="update('${branch}','${id}','owner',this.value)">

<button
class="btn-delete"
onclick="deleteTool('${branch}','${id}')">

מחק כלי

</button>

</div>
`
}

function update(branch,id,key,value){

config.branches[branch].items[id][key]=value

}

function addTool(branch){

const id="tool_"+Date.now()

config.branches[branch].items[id]={

name:"כלי חדש",

botType:"",

systemPrompt:"",

thinkingBudget:512,

_layer:inferLayer(branch),

scope:"global",

owner:"system",

createdAt:new Date().toISOString()

}

render()

}

function inferLayer(branch){

if(branch==="courses")return"course_general"
if(branch==="skills")return"skills_process"
if(branch==="faculty")return"faculty_tool"
if(branch==="admin")return"admin_tool"

return"course_general"

}

function deleteTool(branch,id){

delete config.branches[branch].items[id]

render()

}

function generateConfig(){

const out=document.getElementById("output")

out.style.display="block"

out.value=JSON.stringify(config,null,2)

out.select()

alert("הקוד מוכן להעתקה ל-config.json")

}

</script>

</body>
</html>
